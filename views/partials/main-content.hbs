<!-- Âè≥‰æßÂÜÖÂÆπÂå∫Âüü -->
<div class="flex flex-col min-h-0">
    <!-- Mobile Header -->
    <div class="lg:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between h-16 px-4">
            <button id="mobileMenuButton" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                <span>‚ò∞</span>
            </button>
            <h1 class="text-lg font-semibold text-gray-900 dark:text-white">üìö Â≠¶‰π†ËøΩË∏™</h1>
            <div class="flex items-center space-x-2">
                <button id="mobileDarkModeToggle" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <span id="mobileDarkModeIcon">üåô</span>
                </button>
                <div class="w-8 h-8 bg-gray-800 dark:bg-gray-700 rounded-full flex items-center justify-center text-white font-medium border-2 border-gray-300 dark:border-gray-600 overflow-hidden header-avatar">
                    {{#if user.avatar}}
                        <img src="/uploads/avatars/{{user.avatar}}" alt="Áî®Êà∑Â§¥ÂÉè" class="w-full h-full object-cover">
                    {{else}}
                        {{user.username.[0]}}
                    {{/if}}
                </div>
            </div>
        </div>
    </div>

    <!-- Desktop Header -->
    <div class="hidden lg:flex items-center justify-between h-16 px-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center space-x-4">
            <h1 id="pageTitle" class="text-xl font-semibold text-gray-900 dark:text-white">Ê¨¢Ëøé‰ΩøÁî®Â≠¶‰π†ËøΩË∏™Á≥ªÁªü</h1>
            {{#if breadcrumbs}}
            <nav class="flex space-x-2 text-sm text-gray-500 dark:text-gray-400">
                {{#each breadcrumbs}}
                <span>{{this}}</span>
                {{#unless @last}}<span>/</span>{{/unless}}
                {{/each}}
            </nav>
            {{/if}}
        </div>
        <div class="flex items-center space-x-4">
            <button id="desktopDarkModeToggle" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                <span id="desktopDarkModeIcon">üåô</span>
            </button>
            <div class="relative" id="userDropdown">
                <button id="userDropdownButton" class="flex items-center space-x-2 p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                    <div class="w-8 h-8 bg-gray-800 dark:bg-gray-700 rounded-full flex items-center justify-center text-white font-medium border-2 border-gray-300 dark:border-gray-600 overflow-hidden header-avatar">
                        {{#if user.avatar}}
                            <img src="/uploads/avatars/{{user.avatar}}" alt="Áî®Êà∑Â§¥ÂÉè" class="w-full h-full object-cover">
                        {{else}}
                            {{user.username.[0]}}
                        {{/if}}
                    </div>
                    <span class="hidden md:block">{{user.username}}</span>
                </button>
                <div id="userDropdownMenu" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700" style="display: none;">
                    <div class="py-2">
                        <button id="openProfileModalBtn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                            ‰∏™‰∫∫ËÆæÁΩÆ
                        </button>
                        <a href="/logout" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                            ÈÄÄÂá∫ÁôªÂΩï
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="flex-1 bg-gray-50 dark:bg-gray-900 min-h-0">
        <div id="contentArea" class="p-6">
            <!-- Âä®ÊÄÅÂÜÖÂÆπÂå∫Âüü -->
            <div id="dynamicContent">
                <!-- Âä®ÊÄÅÂÜÖÂÆπÂ∞ÜÈÄöËøáAJAXÂä†ËΩΩ -->
            </div>
        </div>
    </main>
</div>

<!-- ‰∏™‰∫∫ËÆæÁΩÆÂºπÁ™ó -->
<div id="profileModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm transition-all duration-300 hidden p-4">
    <div class="relative w-full mx-2 sm:mx-auto" style="max-width: 32rem; width: 100%; max-height: 90vh;">
        <!-- ÂºπÁ™ó‰∏ª‰Ωì -->
        <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-2xl transition-all duration-300 scale-95 opacity-0 flex flex-col" style="width: 100%; max-height: 90vh;">
            <!-- Â§¥ÈÉ® -->
            <div class="flex items-center justify-between px-6 pt-6 pb-2 border-b border-gray-100 dark:border-gray-800 flex-shrink-0">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">‰∏™‰∫∫ËÆæÁΩÆ</h3>
                </div>
                <button id="closeProfileModalBtn" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">
                    <svg class="w-5 h-5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- ÂÜÖÂÆπÂå∫ -->
            <form id="profileForm" class="px-6 py-6 flex-1 overflow-y-auto">
                <div class="space-y-4">
                    <!-- Áî®Êà∑Â§¥ÂÉè -->
                    <div class="flex items-center justify-center mb-6">
                        <div class="relative">
                            <!-- Â§¥ÂÉèÊòæÁ§∫Âå∫Âüü -->
                            <div id="avatarDisplay" class="w-20 h-20 bg-gray-800 dark:bg-gray-700 rounded-full flex items-center justify-center text-white text-2xl font-bold border-4 border-gray-300 dark:border-gray-600 overflow-hidden">
                                {{#if user.avatar}}
                                    <img id="avatarImage" src="/uploads/avatars/{{user.avatar}}" alt="Áî®Êà∑Â§¥ÂÉè" class="w-full h-full object-cover">
                                {{else}}
                                    <span id="avatarInitial">{{user.username.[0]}}</span>
                                {{/if}}
                            </div>
                            
                            <!-- Â§¥ÂÉè‰∏ä‰º†ÊåâÈíÆ -->
                            <button type="button" id="changeAvatarBtn" class="absolute -bottom-1 -right-1 w-7 h-7 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs hover:bg-blue-700 transition-colors shadow-lg">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </button>
                            
                            <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°Ü -->
                            <input type="file" id="avatarInput" accept="image/*" class="hidden">
                        </div>
                    </div>
                    
                    <!-- Â§¥ÂÉèÊìç‰ΩúÊèêÁ§∫ -->
                    <div class="text-center mb-4">
                        <p class="text-xs text-gray-500 dark:text-gray-400">ÁÇπÂáªÁõ∏Êú∫ÂõæÊ†á‰∏ä‰º†Â§¥ÂÉèÔºåÊîØÊåÅ JPG„ÄÅPNG Ê†ºÂºèÔºåÊúÄÂ§ß 5MB</p>
                    </div>

                    <!-- Áî®Êà∑Âêç -->
                    <div>
                        <label for="profileUsername" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Áî®Êà∑Âêç <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="profileUsername" name="username" required
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                               placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç" value="{{user.username}}" autocomplete="username">
                    </div>

                    <!-- ÈÇÆÁÆ±Âú∞ÂùÄ -->
                    <div>
                        <label for="profileEmail" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            ÈÇÆÁÆ±Âú∞ÂùÄ <span class="text-red-500">*</span>
                        </label>
                        <input type="email" id="profileEmail" name="email" required
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                               placeholder="ËØ∑ËæìÂÖ•ÈÇÆÁÆ±Âú∞ÂùÄ" value="{{user.email}}" autocomplete="email">
                    </div>

                    <!-- ÂΩìÂâçÂØÜÁ†Å -->
                    <div>
                        <label for="currentPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            ÂΩìÂâçÂØÜÁ†Å
                        </label>
                        <input type="password" id="currentPassword" name="currentPassword" autocomplete="current-password"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                               placeholder="Â¶ÇÈúÄ‰øÆÊîπÂØÜÁ†ÅËØ∑ËæìÂÖ•ÂΩìÂâçÂØÜÁ†Å">
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Âè™ÊúâËæìÂÖ•ÂΩìÂâçÂØÜÁ†ÅÊâçËÉΩ‰øÆÊîπÂØÜÁ†Å</p>
                    </div>

                    <!-- Êñ∞ÂØÜÁ†Å -->
                    <div>
                        <label for="newPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Êñ∞ÂØÜÁ†Å
                        </label>
                        <input type="password" id="newPassword" name="newPassword" autocomplete="new-password"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                               placeholder="ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å">
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë6‰ΩçÔºåÂåÖÂê´Â≠óÊØçÂíåÊï∞Â≠ó</p>
                    </div>

                    <!-- Á°ÆËÆ§Êñ∞ÂØÜÁ†Å -->
                    <div>
                        <label for="confirmPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Á°ÆËÆ§Êñ∞ÂØÜÁ†Å
                        </label>
                        <input type="password" id="confirmPassword" name="confirmPassword" autocomplete="new-password"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                               placeholder="ËØ∑ÂÜçÊ¨°ËæìÂÖ•Êñ∞ÂØÜÁ†Å">
                    </div>

                    <!-- ÈÄöÁü•ËÆæÁΩÆ -->
                    <div class="pt-4 border-t border-gray-100 dark:border-gray-800">
                        <h4 class="text-sm font-medium text-gray-900 dark:text-white mb-3">ÈÄöÁü•ËÆæÁΩÆ</h4>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="emailNotifications" name="emailNotifications" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Êé•Êî∂ÈÇÆ‰ª∂ÈÄöÁü•</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="browserNotifications" name="browserNotifications" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Êé•Êî∂ÊµèËßàÂô®ÈÄöÁü•</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="studyReminders" name="studyReminders" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Â≠¶‰π†ÊèêÈÜí</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Ê∂àÊÅØÊòæÁ§∫Âå∫Âüü -->
                <div id="profileMessage" class="mt-4"></div>
                
                <!-- ÊåâÈíÆÂå∫ -->
                <div class="flex flex-col-reverse sm:flex-row gap-4 pt-6 border-t border-gray-100 dark:border-gray-800 flex-shrink-0">
                    <button type="button" id="deactivateAccountBtn" 
                            class="w-full sm:w-auto px-4 py-2 border border-red-300 dark:border-red-700 rounded-lg text-red-700 dark:text-red-300 bg-white dark:bg-gray-900 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors duration-200 font-medium">
                        <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        Ê≥®ÈîÄË¥¶Êà∑
                    </button>
                    <button type="button" id="cancelProfileBtn" 
                            class="w-full sm:w-auto px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors duration-200 font-medium">
                        ÂèñÊ∂à
                    </button>
                    <button type="submit" id="saveProfileBtn" 
                            class="w-full sm:w-auto px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-200 flex items-center justify-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        ‰øùÂ≠òËÆæÁΩÆ
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Ê≥®ÈîÄÁ°ÆËÆ§ÂºπÁ™ó -->
<div id="deactivateModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm transition-all duration-300 hidden p-4">
    <div class="relative w-full mx-2 sm:mx-auto" style="max-width: 28rem; width: 100%;">
        <!-- ÂºπÁ™ó‰∏ª‰Ωì -->
        <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-2xl transition-all duration-300 scale-95 opacity-0">
            <!-- Â§¥ÈÉ® -->
            <div class="flex items-center justify-between px-6 pt-6 pb-2 border-b border-gray-100 dark:border-gray-800">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">Ê≥®ÈîÄË¥¶Êà∑</h3>
                </div>
                <button id="closeDeactivateModalBtn" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">
                    <svg class="w-5 h-5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- ÂÜÖÂÆπÂå∫ -->
            <div class="px-6 py-6">
                <div class="space-y-4">
                    <!-- Ë≠¶Âëä‰ø°ÊÅØ -->
                    <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                        <div class="flex">
                            <svg class="w-5 h-5 text-red-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                            <div class="ml-3">
                                <h4 class="text-sm font-medium text-red-800 dark:text-red-200">ÈáçË¶ÅÊèêÈÜí</h4>
                                <p class="text-sm text-red-700 dark:text-red-300 mt-1">
                                    Ê≥®ÈîÄË¥¶Êà∑ÂêéÔºåÊÇ®ÁöÑÊâÄÊúâÊï∞ÊçÆÂ∞ÜË¢´Ê∞∏‰πÖÂà†Èô§ÔºåÂåÖÊã¨Â≠¶‰π†ËÆ∞ÂΩï„ÄÅÊàêÂ∞±„ÄÅÁßØÂàÜÁ≠â„ÄÇÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- ÈÇÆÁÆ±È™åËØÅ -->
                    <div id="emailVerificationSection">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            ÈÇÆÁÆ±È™åËØÅÁ†Å <span class="text-red-500">*</span>
                        </label>
                        <div class="flex space-x-2">
                            <input type="text" id="verificationCode" name="verificationCode" maxlength="6"
                                   class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                                   placeholder="ËØ∑ËæìÂÖ•6‰ΩçÈ™åËØÅÁ†Å">
                            <button type="button" id="sendVerificationCodeBtn"
                                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors duration-200">
                                ÂèëÈÄÅÈ™åËØÅÁ†Å
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            È™åËØÅÁ†ÅÂ∞ÜÂèëÈÄÅÂà∞ÊÇ®ÁöÑÊ≥®ÂÜåÈÇÆÁÆ±ÔºåÁî®‰∫éÁ°ÆËÆ§Ê≥®ÈîÄÊìç‰Ωú
                        </p>
                    </div>

                    <!-- Á°ÆËÆ§ËæìÂÖ• -->
                    <div>
                        <label for="confirmDeactivate" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Á°ÆËÆ§Ê≥®ÈîÄ <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="confirmDeactivate" name="confirmDeactivate"
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                               placeholder="ËØ∑ËæìÂÖ•'Ê≥®ÈîÄË¥¶Êà∑'Á°ÆËÆ§Êìç‰Ωú">
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            ËØ∑ËæìÂÖ•"Ê≥®ÈîÄË¥¶Êà∑"‰ª•Á°ÆËÆ§ÊÇ®Ë¶ÅÊ≥®ÈîÄË¥¶Êà∑
                        </p>
                    </div>

                    <!-- Ê∂àÊÅØÊòæÁ§∫Âå∫Âüü -->
                    <div id="deactivateMessage" class="mt-4"></div>
                </div>

                <!-- ÊåâÈíÆÂå∫ -->
                <div class="flex flex-col-reverse sm:flex-row gap-4 pt-6 border-t border-gray-100 dark:border-gray-800">
                    <button type="button" id="cancelDeactivateBtn"
                            class="w-full sm:w-auto px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-900 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors duration-200 font-medium">
                        ÂèñÊ∂à
                    </button>
                    <button type="button" id="confirmDeactivateBtn"
                            class="w-full sm:w-auto px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-200 flex items-center justify-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        Á°ÆËÆ§Ê≥®ÈîÄ
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Áî®Êà∑‰∏ãÊãâËèúÂçïÂäüËÉΩ
function toggleUserDropdown() {
    const dropdown = document.getElementById('userDropdownMenu');
    if (dropdown) {
        const isVisible = dropdown.style.display !== 'none';
        dropdown.style.display = isVisible ? 'none' : 'block';
    }
}

function closeUserDropdown() {
    const dropdown = document.getElementById('userDropdownMenu');
    if (dropdown) {
        dropdown.style.display = 'none';
    }
}

// ‰∏™‰∫∫ËÆæÁΩÆÂºπÁ™óÂäüËÉΩ
function showProfileModal() {
    const modal = document.getElementById('profileModal');
    const modalContent = modal?.querySelector('.bg-white, .dark\\:bg-gray-900');
    
    if (modal && modalContent) {
        // ÈáçÁΩÆË°®Âçï
        const form = document.getElementById('profileForm');
        if (form) {
            form.reset();
        }
        
        // Ê∏ÖÈô§Ê∂àÊÅØ
        const messageDiv = document.getElementById('profileMessage');
        if (messageDiv) {
            messageDiv.innerHTML = '';
        }
        
        // ÊòæÁ§∫ÂºπÁ™ó
        modal.classList.remove('hidden');
        
        // Ê∑ªÂä†ÊòæÁ§∫Âä®Áîª
        setTimeout(() => {
            modalContent.classList.remove('scale-95', 'opacity-0');
            modalContent.classList.add('scale-100', 'opacity-100');
        }, 10);
        
        // ÂÖ≥Èó≠Áî®Êà∑‰∏ãÊãâËèúÂçï
        closeUserDropdown();
    }
}

function hideProfileModal() {
    const modal = document.getElementById('profileModal');
    const modalContent = modal?.querySelector('.bg-white, .dark\\:bg-gray-900');
    
    if (modal && modalContent) {
        // Ê∑ªÂä†ÂÖ≥Èó≠Âä®Áîª
        modalContent.classList.remove('scale-100', 'opacity-100');
        modalContent.classList.add('scale-95', 'opacity-0');
        
        // Á≠âÂæÖÂä®ÁîªÂÆåÊàêÂêéÈöêËóèÂºπÁ™ó
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 300);
    }
}

// ÂÜÖÂÆπÂàáÊç¢ÂäüËÉΩ
function showContent(contentType) {
    const dynamicContent = document.getElementById('dynamicContent');
    const pageTitle = document.getElementById('pageTitle');
    
    // Ê†πÊçÆÂÜÖÂÆπÁ±ªÂûãËÆæÁΩÆÊ†áÈ¢ò
    const titles = {
        'dashboard': '‰ª™Ë°®Êùø',
        'projects': 'È°πÁõÆÁÆ°ÁêÜ',
        'sessions': 'Â≠¶‰π†ËÆ∞ÂΩï',
        'analytics': 'Êï∞ÊçÆÂàÜÊûê',
        'notifications': 'ÈÄöÁü•‰∏≠ÂøÉ',
        'admin': 'Á≥ªÁªüÁÆ°ÁêÜ'
    };
    pageTitle.textContent = titles[contentType] || 'Â≠¶‰π†ËøΩË∏™Á≥ªÁªü';
    
    // ÈÄöËøáAJAXÂä†ËΩΩÂØπÂ∫îÈ°µÈù¢ÂÜÖÂÆπÔºåËèúÂçïÂàáÊç¢Êó∂‰∏çÊòæÁ§∫ÊàêÂäüÈÄöÁü•
    loadPageContent(contentType, false);
}

// Âä†ËΩΩÈ°µÈù¢ÂÜÖÂÆπ
async function loadPageContent(contentType, showSuccessNotification = true) {
    console.log('loadPageContent Ë¢´Ë∞ÉÁî®ÔºåcontentType:', contentType, 'showSuccessNotification:', showSuccessNotification);
    console.log('Ë∞ÉÁî®Ê†à:', new Error().stack);
    
    const dynamicContent = document.getElementById('dynamicContent');
    
    try {
        // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
        dynamicContent.innerHTML = `
            <div class="flex items-center justify-center h-64">
                <div class="text-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-2 border-primary-600 border-t-transparent mx-auto mb-4"></div>
                    <p class="text-gray-600 dark:text-gray-400">Ê≠£Âú®Âä†ËΩΩ...</p>
                </div>
            </div>
        `;
        
        // ÂèëÈÄÅAJAXËØ∑Ê±ÇËé∑ÂèñÈ°µÈù¢ÂÜÖÂÆπ
        let requestUrl = `/${contentType}`;
        
        // Â§ÑÁêÜÁÆ°ÁêÜÁ´ØÈ°µÈù¢ÁöÑË∑ØÁî±Êò†Â∞Ñ
        if (contentType === 'admin-points-exchange') {
            requestUrl = '/admin/points-exchange';
        } else if (contentType === 'admin-exchange-approval') {
            requestUrl = '/admin/exchange-approval';
        }
        
        // DemoÊ®°Âºè‰∏ãÊ∑ªÂä†ÂâçÁºÄ
        if (window.isDemo) {
            requestUrl = '/demo' + requestUrl;
        }
        
        console.log('ÂèëÈÄÅ AJAX ËØ∑Ê±ÇÂà∞:', requestUrl);
        const response = await fetch(requestUrl, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Accept': 'text/html'
            },
            credentials: 'same-origin'
        });
        
        if (response.ok) {
            const content = await response.text();
            console.log('È°µÈù¢ÂÜÖÂÆπÂä†ËΩΩÊàêÂäüÔºåÈïøÂ∫¶:', content.length);
            dynamicContent.innerHTML = content;
            
            // Êõ¥Êñ∞ÊµèËßàÂô®ÂéÜÂè≤
            const url = window.isDemo ? `/demo/${contentType}` : `/${contentType}`;
            window.history.pushState({ contentType }, '', url);
            
            // ÊâßË°åÈ°µÈù¢ÁâπÂÆöÁöÑÂàùÂßãÂåñËÑöÊú¨
            console.log('ÂáÜÂ§áÊâßË°åÈ°µÈù¢ËÑöÊú¨ÔºåcontentType:', contentType);
            executePageScripts(contentType);
            
            // Âè™Âú®ÈúÄË¶ÅÊó∂ÊòæÁ§∫ÊàêÂäüÈÄöÁü•
            if (showSuccessNotification && window.showNotification) {
                window.showNotification('È°µÈù¢Âä†ËΩΩÊàêÂäü', 'success', 2000);
            }
        } else {
            throw new Error(`HTTP ${response.status}`);
        }
    } catch (error) {
        console.error('Âä†ËΩΩÈ°µÈù¢ÂÜÖÂÆπÂ§±Ë¥•:', error);
        dynamicContent.innerHTML = `
            <div class="flex items-center justify-center h-64">
                <div class="text-center">
                    <div class="text-red-500 text-4xl mb-4">‚ùå</div>
                    <p class="text-gray-600 dark:text-gray-400">Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï</p>
                    <button onclick="loadPageContent('${contentType}', true)" class="mt-4 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700">
                        ÈáçÊñ∞Âä†ËΩΩ
                    </button>
                </div>
            </div>
        `;
        
        if (window.showNotification) {
            window.showNotification('È°µÈù¢Âä†ËΩΩÂ§±Ë¥•', 'error', 5000);
        }
    }
}

// ÊâßË°åÈ°µÈù¢ÁâπÂÆöÁöÑÂàùÂßãÂåñËÑöÊú¨
function executePageScripts(contentType) {
    console.log('ÊâßË°åÈ°µÈù¢ËÑöÊú¨:', contentType);
    
    switch(contentType) {
        case 'admin':
            // Á≥ªÁªüÁÆ°ÁêÜÈ°µÈù¢ÂàùÂßãÂåñ
            loadAdminScript().then(() => {
                if (typeof initializeAdminPage === 'function') {
                    console.log('ÂàùÂßãÂåñÁ≥ªÁªüÁÆ°ÁêÜÈ°µÈù¢...');
                    initializeAdminPage();
                } else {
                    console.error('initializeAdminPage ÂáΩÊï∞Êú™ÊâæÂà∞');
                }
            }).catch(error => {
                console.error('Âä†ËΩΩ admin.js Â§±Ë¥•:', error);
            });
            break;
        case 'dashboard':
            // ‰ª™Ë°®ÊùøÈ°µÈù¢ÂàùÂßãÂåñ
            console.log('Ê£ÄÊµãÂà∞ dashboard È°µÈù¢ÔºåÂºÄÂßãÂä†ËΩΩ dashboard.js...');
            if (!window.dashboardScriptLoaded) {
                // Á°Æ‰øùChart.jsÂ∑≤Âä†ËΩΩ
                if (typeof Chart === 'undefined') {
                    console.log('Chart.js Êú™Âä†ËΩΩÔºåÂÖàÂä†ËΩΩ Chart.js...');
                    const chartScript = document.createElement('script');
                    chartScript.src = '/assets/lib/chart.umd.min.js';
                    chartScript.onload = function() {
                        console.log('Chart.js Âä†ËΩΩÊàêÂäüÔºåÁé∞Âú®Âä†ËΩΩ dashboard.js...');
                        loadDashboardScript();
                    };
                    chartScript.onerror = function() {
                        console.error('Chart.js Âä†ËΩΩÂ§±Ë¥•');
                        loadDashboardScript();
                    };
                    document.head.appendChild(chartScript);
                } else {
                    console.log('Chart.js Â∑≤Âä†ËΩΩÔºåÁõ¥Êé•Âä†ËΩΩ dashboard.js...');
                    loadDashboardScript();
                }
            } else {
                if (typeof initializeDashboard === 'function') {
                    initializeDashboard();
                }
            }
            break;
        case 'projects':
            // È°πÁõÆÁÆ°ÁêÜÈ°µÈù¢ÂàùÂßãÂåñ
            console.log('ÂàùÂßãÂåñÈ°πÁõÆÁÆ°ÁêÜÈ°µÈù¢...');
            
            // Á°Æ‰øùChart.jsÂ∑≤Âä†ËΩΩ
            if (typeof Chart === 'undefined') {
                console.log('Chart.js Êú™Âä†ËΩΩÔºåÂÖàÂä†ËΩΩ Chart.js...');
                const chartScript = document.createElement('script');
                chartScript.src = '/assets/lib/chart.umd.min.js';
                chartScript.onload = function() {
                    console.log('Chart.js Âä†ËΩΩÊàêÂäüÔºåÁé∞Âú®ÊâßË°åÈ°µÈù¢ËÑöÊú¨...');
                    executeProjectScripts();
                };
                chartScript.onerror = function() {
                    console.error('Chart.js Âä†ËΩΩÂ§±Ë¥•ÔºåÁªßÁª≠ÊâßË°åÈ°µÈù¢ËÑöÊú¨...');
                    executeProjectScripts();
                };
                document.head.appendChild(chartScript);
            } else {
                console.log('Chart.js Â∑≤Âä†ËΩΩÔºåÁõ¥Êé•ÊâßË°åÈ°µÈù¢ËÑöÊú¨...');
                executeProjectScripts();
            }
            break;
        case 'sessions':
            // Â≠¶‰π†ËÆ∞ÂΩïÈ°µÈù¢ÂàùÂßãÂåñ - ÈúÄË¶ÅÊâãÂä®Âä†ËΩΩ sessions.js
            console.log('ÂàùÂßãÂåñÂ≠¶‰π†ËÆ∞ÂΩïÈ°µÈù¢...');
            if (typeof SessionsManager !== 'undefined') {
                // Â¶ÇÊûú SessionsManager Â∑≤Â≠òÂú®ÔºåÁõ¥Êé•ÂàùÂßãÂåñ
                if (window.sessionsManager) {
                    console.log('Ê∏ÖÁêÜÁé∞Êúâ SessionsManager ÂÆû‰æã');
                    // Ê∏ÖÁêÜÁé∞ÊúâÂÆû‰æã
                    if (window.sessionsManager.handleEscapeKey) {
                        document.removeEventListener('keydown', window.sessionsManager.handleEscapeKey);
                    }
                    window.sessionsManager = null;
                }
                console.log('ÂàõÂª∫Êñ∞ÁöÑ SessionsManager ÂÆû‰æã');
                window.sessionsManager = new SessionsManager();
            } else {
                console.log('SessionsManager Êú™ÊâæÂà∞ÔºåÊâãÂä®Âä†ËΩΩ sessions.js...');
                loadSessionsScript().then(() => {
                    if (typeof SessionsManager !== 'undefined') {
                        console.log('ÂàõÂª∫Êñ∞ÁöÑ SessionsManager ÂÆû‰æã');
                        window.sessionsManager = new SessionsManager();
                    } else {
                        console.error('SessionsManager ‰ªçÁÑ∂Êú™ÊâæÂà∞');
                    }
                }).catch(error => {
                    console.error('Âä†ËΩΩ sessions.js Â§±Ë¥•:', error);
                });
            }
            break;
        case 'analytics':
            // Êï∞ÊçÆÂàÜÊûêÈ°µÈù¢ÂàùÂßãÂåñ
            if (typeof initializeAnalytics === 'function') {
                console.log('ÂàùÂßãÂåñÊï∞ÊçÆÂàÜÊûêÈ°µÈù¢...');
                initializeAnalytics();
            }
            break;
        case 'notifications':
            // ÈÄöÁü•‰∏≠ÂøÉÈ°µÈù¢ÂàùÂßãÂåñ
            console.log('ÂàùÂßãÂåñÈÄöÁü•‰∏≠ÂøÉÈ°µÈù¢...');
            // ÈÄöÁü•È°µÈù¢ÁöÑ JS Âú®Áã¨Á´ãÁöÑ notifications.js Êñá‰ª∂‰∏≠
            executeNotificationScripts();
            break;
        case 'achievements':
            // ÊàêÂ∞±È°µÈù¢ÂàùÂßãÂåñ
            console.log('ÂàùÂßãÂåñÊàêÂ∞±È°µÈù¢...');
            // ÊàêÂ∞±È°µÈù¢ÁöÑ JS Â∑≤ÁªèÂÜÖÂµåÂú®È°µÈù¢‰∏≠ÔºåÈúÄË¶ÅÊâãÂä®ÊâßË°å
            executeAchievementScripts();
            break;
        case 'admin-points-exchange':
            // ÁßØÂàÜÂÖëÊç¢ÁÆ°ÁêÜÈ°µÈù¢ÂàùÂßãÂåñ
            console.log('ÂàùÂßãÂåñÁßØÂàÜÂÖëÊç¢ÁÆ°ÁêÜÈ°µÈù¢...');
            // ÁßØÂàÜÂÖëÊç¢ÁÆ°ÁêÜÈ°µÈù¢ÁöÑ JS Â∑≤ÁªèÂÜÖÂµåÂú®È°µÈù¢‰∏≠ÔºåÈúÄË¶ÅÊâãÂä®ÊâßË°å
            executeAdminPointsExchangeScripts();
            break;
        case 'admin-exchange-approval':
            // ÂÖëÊç¢ÂÆ°Ê†∏È°µÈù¢ÂàùÂßãÂåñ
            console.log('ÂàùÂßãÂåñÂÖëÊç¢ÂÆ°Ê†∏È°µÈù¢...');
            // ÂÖëÊç¢ÂÆ°Ê†∏È°µÈù¢ÁöÑ JS Â∑≤ÁªèÂÜÖÂµåÂú®È°µÈù¢‰∏≠ÔºåÈúÄË¶ÅÊâãÂä®ÊâßË°å
            executeAdminExchangeApprovalScripts();
            break;
        default:
            console.log('Ê≤°ÊúâÁâπÂÆöÁöÑÂàùÂßãÂåñËÑöÊú¨:', contentType);
    }
}

// ÊâßË°åÈ°πÁõÆÁÆ°ÁêÜÈ°µÈù¢ËÑöÊú¨
function executeProjectScripts() {
    console.log('ÊâßË°åÈ°πÁõÆÁÆ°ÁêÜÈ°µÈù¢ËÑöÊú¨...');
    
    // Êü•ÊâæÈ°µÈù¢‰∏≠ÁöÑscriptÊ†áÁ≠æÂπ∂ÊâßË°å
    const projectScripts = document.querySelectorAll('#dynamicContent script');
    console.log('ÊâæÂà∞ÁöÑscriptÊ†áÁ≠æÊï∞Èáè:', projectScripts.length);
    
    // Âè™ÊâßË°å‰∏ÄÊ¨°ËÑöÊú¨Ê†áÁ≠æ
    projectScripts.forEach((script, index) => {
        console.log(`ÊâßË°åÁ¨¨${index + 1}‰∏™scriptÊ†áÁ≠æ`);
        try {
            // ÂàõÂª∫Êñ∞ÁöÑscriptÂÖÉÁ¥†Âπ∂ÊâßË°å
            const newScript = document.createElement('script');
            newScript.textContent = script.textContent;
            document.head.appendChild(newScript);
            console.log(`Á¨¨${index + 1}‰∏™scriptÊ†áÁ≠æÊâßË°åÂÆåÊàê`);
        } catch (error) {
            console.error(`ÊâßË°åÁ¨¨${index + 1}‰∏™scriptÊ†áÁ≠æÂ§±Ë¥•:`, error);
        }
    });
    
    // Á≠âÂæÖ‰∏Ä‰∏ãËÆ©ËÑöÊú¨ÊâßË°åÂÆåÊàêÔºåÁÑ∂ÂêéÊ£ÄÊü•initializeProjectsÂáΩÊï∞
    setTimeout(() => {
        console.log('Ê£ÄÊü•ProjectsAppÊòØÂê¶Â∑≤ÂÆö‰πâ:', typeof ProjectsApp);
        console.log('Ê£ÄÊü•initializeProjectsÊòØÂê¶Â∑≤ÂÆö‰πâ:', typeof initializeProjects);
        
        if (typeof ProjectsApp === 'undefined') {
            console.error('ProjectsApp Á±ªÊú™ÂÆö‰πâÔºå‰ΩÜ‰∏çÂÜçÈáçÂ§çÊâßË°åËÑöÊú¨');
        } else if (typeof initializeProjects === 'function') {
            console.log('Ë∞ÉÁî® initializeProjects ÂáΩÊï∞');
            initializeProjects();
        } else {
            console.error('initializeProjects ÂáΩÊï∞Êú™ÊâæÂà∞');
        }
    }, 100);
}

// ÊâßË°åÊàêÂ∞±È°µÈù¢ËÑöÊú¨
function executeAchievementScripts() {
    console.log('ÊâßË°åÊàêÂ∞±È°µÈù¢ËÑöÊú¨...');
    
    // Êü•ÊâæÈ°µÈù¢‰∏≠ÁöÑscriptÊ†áÁ≠æÂπ∂ÊâßË°å
    const achievementScripts = document.querySelectorAll('#dynamicContent script');
    console.log('ÊâæÂà∞ÁöÑscriptÊ†áÁ≠æÊï∞Èáè:', achievementScripts.length);
    
    // Âè™ÊâßË°å‰∏ÄÊ¨°ËÑöÊú¨Ê†áÁ≠æ
    achievementScripts.forEach((script, index) => {
        console.log(`ÊâßË°åÁ¨¨${index + 1}‰∏™scriptÊ†áÁ≠æ`);
        try {
            // ÂàõÂª∫Êñ∞ÁöÑscriptÂÖÉÁ¥†Âπ∂ÊâßË°å
            const newScript = document.createElement('script');
            newScript.textContent = script.textContent;
            document.head.appendChild(newScript);
            console.log(`Á¨¨${index + 1}‰∏™scriptÊ†áÁ≠æÊâßË°åÂÆåÊàê`);
        } catch (error) {
            console.error(`ÊâßË°åÁ¨¨${index + 1}‰∏™scriptÊ†áÁ≠æÂ§±Ë¥•:`, error);
        }
    });
    
    // Á≠âÂæÖ‰∏Ä‰∏ãËÆ©ËÑöÊú¨ÊâßË°åÂÆåÊàêÔºåÁÑ∂ÂêéÊ£ÄÊü•AchievementPageÁ±ª
    setTimeout(() => {
        console.log('Ê£ÄÊü•AchievementPageÊòØÂê¶Â∑≤ÂÆö‰πâ:', typeof AchievementPage);
        
        if (typeof AchievementPage === 'undefined') {
            console.error('AchievementPage Á±ªÊú™ÂÆö‰πâ');
        } else {
            console.log('AchievementPage Á±ªÂ∑≤ÂÆö‰πâÔºåÂ∞ùËØïÂàõÂª∫ÂÆû‰æã');
            try {
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ÂÆû‰æã
                if (window.achievementPage) {
                    console.log('Ê∏ÖÁêÜÁé∞Êúâ AchievementPage ÂÆû‰æã');
                    window.achievementPage = null;
                }
                
                // ÂàõÂª∫Êñ∞ÂÆû‰æã
                window.achievementPage = new AchievementPage();
                console.log('AchievementPage ÂÆû‰æãÂàõÂª∫ÊàêÂäü');
            } catch (error) {
                console.error('ÂàõÂª∫ AchievementPage ÂÆû‰æãÂ§±Ë¥•:', error);
            }
        }
    }, 100);
}

// ÊâßË°åÈÄöÁü•È°µÈù¢ËÑöÊú¨
function executeNotificationScripts() {
    console.log('ÊâßË°åÈÄöÁü•È°µÈù¢ËÑöÊú¨...');
    
    // Êü•ÊâæÈ°µÈù¢‰∏≠ÁöÑscriptÊ†áÁ≠æÂπ∂ÊâßË°å
    const notificationScripts = document.querySelectorAll('#dynamicContent script');
    console.log('ÊâæÂà∞ÁöÑscriptÊ†áÁ≠æÊï∞Èáè:', notificationScripts.length);
    
    // Âè™ÊâßË°å‰∏ÄÊ¨°ËÑöÊú¨Ê†áÁ≠æ
    notificationScripts.forEach((script, index) => {
        console.log(`ÊâßË°åÁ¨¨${index + 1}‰∏™scriptÊ†áÁ≠æ`);
        try {
            // ÂàõÂª∫Êñ∞ÁöÑscriptÂÖÉÁ¥†Âπ∂ÊâßË°å
            const newScript = document.createElement('script');
            newScript.textContent = script.textContent;
            document.head.appendChild(newScript);
            console.log(`Á¨¨${index + 1}‰∏™scriptÊ†áÁ≠æÊâßË°åÂÆåÊàê`);
        } catch (error) {
            console.error(`ÊâßË°åÁ¨¨${index + 1}‰∏™scriptÊ†áÁ≠æÂ§±Ë¥•:`, error);
        }
    });
    
    // Á≠âÂæÖ‰∏Ä‰∏ãËÆ©ËÑöÊú¨ÊâßË°åÂÆåÊàêÔºåÁÑ∂ÂêéÊ£ÄÊü•NotificationsPageÁ±ª
    setTimeout(() => {
        console.log('Ê£ÄÊü•NotificationsPageÊòØÂê¶Â∑≤ÂÆö‰πâ:', typeof NotificationsPage);
        
        if (typeof NotificationsPage === 'undefined') {
            console.error('NotificationsPage Á±ªÊú™ÂÆö‰πâÔºåÂ∞ùËØïÂä†ËΩΩ notifications.js');
            // Â∞ùËØïÂä†ËΩΩ notifications.js Êñá‰ª∂
            loadExternalScript('/assets/js/notifications.js').then(() => {
                console.log('notifications.js Âä†ËΩΩÂÆåÊàêÔºåÊ£ÄÊü• NotificationsPage Á±ª');
                if (typeof NotificationsPage !== 'undefined') {
                    console.log('NotificationsPage Á±ªÂ∑≤ÂÆö‰πâÔºåÂ∞ùËØïÂàõÂª∫ÂÆû‰æã');
                    try {
                        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ÂÆû‰æã
                        if (window.notificationsPage) {
                            console.log('Ê∏ÖÁêÜÁé∞Êúâ NotificationsPage ÂÆû‰æã');
                            window.notificationsPage = null;
                        }
                        
                        // ÂàõÂª∫Êñ∞ÂÆû‰æã
                        window.notificationsPage = new NotificationsPage();
                        console.log('NotificationsPage ÂÆû‰æãÂàõÂª∫ÊàêÂäü');
                    } catch (error) {
                        console.error('ÂàõÂª∫ NotificationsPage ÂÆû‰æãÂ§±Ë¥•:', error);
                    }
                } else {
                    console.error('NotificationsPage Á±ª‰ªçÁÑ∂Êú™ÂÆö‰πâ');
                }
            }).catch(error => {
                console.error('Âä†ËΩΩ notifications.js Â§±Ë¥•:', error);
            });
        } else {
            console.log('NotificationsPage Á±ªÂ∑≤ÂÆö‰πâÔºåÂ∞ùËØïÂàõÂª∫ÂÆû‰æã');
            try {
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ÂÆû‰æã
                if (window.notificationsPage) {
                    console.log('Ê∏ÖÁêÜÁé∞Êúâ NotificationsPage ÂÆû‰æã');
                    window.notificationsPage = null;
                }
                
                // ÂàõÂª∫Êñ∞ÂÆû‰æã
                window.notificationsPage = new NotificationsPage();
                console.log('NotificationsPage ÂÆû‰æãÂàõÂª∫ÊàêÂäü');
            } catch (error) {
                console.error('ÂàõÂª∫ NotificationsPage ÂÆû‰æãÂ§±Ë¥•:', error);
            }
        }
    }, 100);
}

// Âä†ËΩΩÂ§ñÈÉ®JavaScriptÊñá‰ª∂ÁöÑËæÖÂä©ÂáΩÊï∞
function loadExternalScript(src, callback) {
    return new Promise((resolve, reject) => {
        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂä†ËΩΩËøá
        const existingScript = document.querySelector(`script[src="${src}"]`);
        if (existingScript) {
            console.log(`ËÑöÊú¨Â∑≤Â≠òÂú®: ${src}`);
            if (callback) callback();
            resolve();
            return;
        }
        
        console.log(`Âä†ËΩΩÂ§ñÈÉ®ËÑöÊú¨: ${src}`);
        const script = document.createElement('script');
        script.src = src;
        script.onload = () => {
            console.log(`Â§ñÈÉ®ËÑöÊú¨Âä†ËΩΩÂÆåÊàê: ${src}`);
            if (callback) callback();
            resolve();
        };
        script.onerror = () => {
            console.error(`Â§ñÈÉ®ËÑöÊú¨Âä†ËΩΩÂ§±Ë¥•: ${src}`);
            reject(new Error(`Failed to load ${src}`));
        };
        document.head.appendChild(script);
    });
}

// ÊâßË°åÁßØÂàÜÂÖëÊç¢ÁÆ°ÁêÜÈ°µÈù¢ËÑöÊú¨
function executeAdminPointsExchangeScripts() {
    console.log('ÊâßË°åÁßØÂàÜÂÖëÊç¢ÁÆ°ÁêÜÈ°µÈù¢ËÑöÊú¨...');
    
    // Êü•ÊâæÈ°µÈù¢‰∏≠ÁöÑscriptÊ†áÁ≠æÂπ∂ÊâßË°å
    const scripts = document.querySelectorAll('#dynamicContent script');
    console.log('ÊâæÂà∞ÁöÑscriptÊ†áÁ≠æÊï∞Èáè:', scripts.length);
    
    // Â§ÑÁêÜËÑöÊú¨Ê†áÁ≠æ
    scripts.forEach((script, index) => {
        console.log(`Â§ÑÁêÜÁ¨¨${index + 1}‰∏™scriptÊ†áÁ≠æ`);
        
        if (script.src) {
            // Â§ñÈÉ®JavaScriptÊñá‰ª∂
            console.log(`Âä†ËΩΩÂ§ñÈÉ®ËÑöÊú¨: ${script.src}`);
            loadExternalScript(script.src, () => {
                console.log(`Â§ñÈÉ®ËÑöÊú¨Âä†ËΩΩÂÆåÊàê: ${script.src}`);
                // Ê£ÄÊü•AdminPointsExchangeÁ±ªÊòØÂê¶Â∑≤ÂÆö‰πâ
                setTimeout(() => {
                    console.log('Ê£ÄÊü•AdminPointsExchangeÊòØÂê¶Â∑≤ÂÆö‰πâ:', typeof AdminPointsExchange);
                    
                    if (typeof AdminPointsExchange !== 'undefined') {
                        console.log('AdminPointsExchange Á±ªÂ∑≤ÂÆö‰πâÔºåÂ∞ùËØïÂàõÂª∫ÂÆû‰æã');
                        try {
                            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ÂÆû‰æã
                            if (window.adminPointsExchange) {
                                console.log('Ê∏ÖÁêÜÁé∞Êúâ AdminPointsExchange ÂÆû‰æã');
                                window.adminPointsExchange = null;
                            }
                            
                            // ÂàõÂª∫Êñ∞ÂÆû‰æã
                            window.adminPointsExchange = new AdminPointsExchange();
                            console.log('AdminPointsExchange ÂÆû‰æãÂàõÂª∫ÊàêÂäü');
                        } catch (error) {
                            console.error('ÂàõÂª∫ AdminPointsExchange ÂÆû‰æãÂ§±Ë¥•:', error);
                        }
                    } else {
                        console.error('AdminPointsExchange Á±ª‰ªçÊú™ÂÆö‰πâ');
                    }
                }, 100);
            });
        } else {
            // ÂÜÖËÅîËÑöÊú¨
            try {
                const newScript = document.createElement('script');
                newScript.textContent = script.textContent;
                document.head.appendChild(newScript);
                console.log(`Á¨¨${index + 1}‰∏™ÂÜÖËÅîËÑöÊú¨ÊâßË°åÂÆåÊàê`);
            } catch (error) {
                console.error(`ÊâßË°åÁ¨¨${index + 1}‰∏™ÂÜÖËÅîËÑöÊú¨Â§±Ë¥•:`, error);
            }
        }
    });
    
    // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ËÑöÊú¨Ê†áÁ≠æÔºåÂ∞ùËØïÊâãÂä®Âä†ËΩΩ
    if (scripts.length === 0) {
        console.log('Êú™ÊâæÂà∞ËÑöÊú¨Ê†áÁ≠æÔºåÂ∞ùËØïÊâãÂä®Âä†ËΩΩadmin-points-exchange.js');
        loadExternalScript('/assets/js/admin-points-exchange.js', () => {
            console.log('ÊâãÂä®Âä†ËΩΩadmin-points-exchange.jsÂÆåÊàê');
            setTimeout(() => {
                console.log('Ê£ÄÊü•AdminPointsExchangeÊòØÂê¶Â∑≤ÂÆö‰πâ:', typeof AdminPointsExchange);
                
                if (typeof AdminPointsExchange !== 'undefined') {
                    console.log('AdminPointsExchange Á±ªÂ∑≤ÂÆö‰πâÔºåÂ∞ùËØïÂàõÂª∫ÂÆû‰æã');
                    try {
                        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ÂÆû‰æã
                        if (window.adminPointsExchange) {
                            console.log('Ê∏ÖÁêÜÁé∞Êúâ AdminPointsExchange ÂÆû‰æã');
                            window.adminPointsExchange = null;
                        }
                        
                        // ÂàõÂª∫Êñ∞ÂÆû‰æã
                        window.adminPointsExchange = new AdminPointsExchange();
                        console.log('AdminPointsExchange ÂÆû‰æãÂàõÂª∫ÊàêÂäü');
                    } catch (error) {
                        console.error('ÂàõÂª∫ AdminPointsExchange ÂÆû‰æãÂ§±Ë¥•:', error);
                    }
                } else {
                    console.error('AdminPointsExchange Á±ª‰ªçÊú™ÂÆö‰πâ');
                }
            }, 100);
        });
    }
}

// ÊâßË°åÂÖëÊç¢ÂÆ°Ê†∏È°µÈù¢ËÑöÊú¨
function executeAdminExchangeApprovalScripts() {
    console.log('ÊâßË°åÂÖëÊç¢ÂÆ°Ê†∏È°µÈù¢ËÑöÊú¨...');
    
    // Êü•ÊâæÈ°µÈù¢‰∏≠ÁöÑscriptÊ†áÁ≠æÂπ∂ÊâßË°å
    const scripts = document.querySelectorAll('#dynamicContent script');
    console.log('ÊâæÂà∞ÁöÑscriptÊ†áÁ≠æÊï∞Èáè:', scripts.length);
    
    // Â§ÑÁêÜËÑöÊú¨Ê†áÁ≠æ
    scripts.forEach((script, index) => {
        console.log(`Â§ÑÁêÜÁ¨¨${index + 1}‰∏™scriptÊ†áÁ≠æ`);
        
        if (script.src) {
            // Â§ñÈÉ®JavaScriptÊñá‰ª∂
            console.log(`Âä†ËΩΩÂ§ñÈÉ®ËÑöÊú¨: ${script.src}`);
            loadExternalScript(script.src, () => {
                console.log(`Â§ñÈÉ®ËÑöÊú¨Âä†ËΩΩÂÆåÊàê: ${script.src}`);
                // Ê£ÄÊü•AdminExchangeApprovalÁ±ªÊòØÂê¶Â∑≤ÂÆö‰πâ
                setTimeout(() => {
                    console.log('Ê£ÄÊü•AdminExchangeApprovalÊòØÂê¶Â∑≤ÂÆö‰πâ:', typeof AdminExchangeApproval);
                    
                    if (typeof AdminExchangeApproval !== 'undefined') {
                        console.log('AdminExchangeApproval Á±ªÂ∑≤ÂÆö‰πâÔºåÂ∞ùËØïÂàõÂª∫ÂÆû‰æã');
                        try {
                            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ÂÆû‰æã
                            if (window.adminExchangeApproval) {
                                console.log('Ê∏ÖÁêÜÁé∞Êúâ AdminExchangeApproval ÂÆû‰æã');
                                window.adminExchangeApproval = null;
                            }
                            
                            // ÂàõÂª∫Êñ∞ÂÆû‰æãÂπ∂ÂàùÂßãÂåñ
                            window.adminExchangeApproval = new AdminExchangeApproval();
                            window.adminExchangeApproval.init();
                            console.log('AdminExchangeApproval ÂÆû‰æãÂàõÂª∫Âπ∂ÂàùÂßãÂåñÊàêÂäü');
                        } catch (error) {
                            console.error('ÂàõÂª∫ AdminExchangeApproval ÂÆû‰æãÂ§±Ë¥•:', error);
                        }
                    } else {
                        console.error('AdminExchangeApproval Á±ª‰ªçÊú™ÂÆö‰πâ');
                    }
                }, 100);
            });
        } else {
            // ÂÜÖËÅîËÑöÊú¨
            try {
                const newScript = document.createElement('script');
                newScript.textContent = script.textContent;
                document.head.appendChild(newScript);
                console.log(`Á¨¨${index + 1}‰∏™ÂÜÖËÅîËÑöÊú¨ÊâßË°åÂÆåÊàê`);
            } catch (error) {
                console.error(`ÊâßË°åÁ¨¨${index + 1}‰∏™ÂÜÖËÅîËÑöÊú¨Â§±Ë¥•:`, error);
            }
        }
    });
    
    // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ËÑöÊú¨Ê†áÁ≠æÔºåÂ∞ùËØïÊâãÂä®Âä†ËΩΩ
    if (scripts.length === 0) {
        console.log('Êú™ÊâæÂà∞ËÑöÊú¨Ê†áÁ≠æÔºåÂ∞ùËØïÊâãÂä®Âä†ËΩΩadmin-exchange-approval.js');
        loadExternalScript('/assets/js/admin-exchange-approval.js', () => {
            console.log('ÊâãÂä®Âä†ËΩΩadmin-exchange-approval.jsÂÆåÊàê');
            setTimeout(() => {
                console.log('Ê£ÄÊü•AdminExchangeApprovalÊòØÂê¶Â∑≤ÂÆö‰πâ:', typeof AdminExchangeApproval);
                
                if (typeof AdminExchangeApproval !== 'undefined') {
                    console.log('AdminExchangeApproval Á±ªÂ∑≤ÂÆö‰πâÔºåÂ∞ùËØïÂàõÂª∫ÂÆû‰æã');
                    try {
                        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ÂÆû‰æã
                        if (window.adminExchangeApproval) {
                            console.log('Ê∏ÖÁêÜÁé∞Êúâ AdminExchangeApproval ÂÆû‰æã');
                            window.adminExchangeApproval = null;
                        }
                        
                        // ÂàõÂª∫Êñ∞ÂÆû‰æãÂπ∂ÂàùÂßãÂåñ
                        window.adminExchangeApproval = new AdminExchangeApproval();
                        window.adminExchangeApproval.init();
                        console.log('AdminExchangeApproval ÂÆû‰æãÂàõÂª∫Âπ∂ÂàùÂßãÂåñÊàêÂäü');
                    } catch (error) {
                        console.error('ÂàõÂª∫ AdminExchangeApproval ÂÆû‰æãÂ§±Ë¥•:', error);
                    }
                } else {
                    console.error('AdminExchangeApproval Á±ª‰ªçÊú™ÂÆö‰πâ');
                    // Ê∑ªÂä†ÈáçËØïÊú∫Âà∂
                    setTimeout(() => {
                        console.log('ÈáçËØïÊ£ÄÊü•AdminExchangeApprovalÊòØÂê¶Â∑≤ÂÆö‰πâ:', typeof AdminExchangeApproval);
                        if (typeof AdminExchangeApproval !== 'undefined') {
                            console.log('AdminExchangeApproval Á±ªÂ∑≤ÂÆö‰πâÔºåÂ∞ùËØïÂàõÂª∫ÂÆû‰æã');
                            try {
                                if (window.adminExchangeApproval) {
                                    console.log('Ê∏ÖÁêÜÁé∞Êúâ AdminExchangeApproval ÂÆû‰æã');
                                    window.adminExchangeApproval = null;
                                }
                                window.adminExchangeApproval = new AdminExchangeApproval();
                                window.adminExchangeApproval.init();
                                console.log('AdminExchangeApproval ÂÆû‰æãÂàõÂª∫Âπ∂ÂàùÂßãÂåñÊàêÂäü');
                            } catch (error) {
                                console.error('ÂàõÂª∫ AdminExchangeApproval ÂÆû‰æãÂ§±Ë¥•:', error);
                            }
                        } else {
                            console.error('AdminExchangeApproval Á±ª‰ªçÁÑ∂Êú™ÂÆö‰πâÔºåÂèØËÉΩÈúÄË¶ÅÊ£ÄÊü•Êñá‰ª∂Ë∑ØÂæÑÊàñËØ≠Ê≥ïÈîôËØØ');
                        }
                    }, 500);
                }
            }, 100);
        });
    }
}

// Âä®ÊÄÅÂä†ËΩΩ dashboard.js ËÑöÊú¨
function loadDashboardScript() {
    return new Promise((resolve, reject) => {
        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂä†ËΩΩËøá
        if (typeof initializeDashboard === 'function') {
            console.log('dashboard.js Â∑≤ÁªèÂä†ËΩΩ');
            resolve();
            return;
        }
        
        console.log('Âä®ÊÄÅÂä†ËΩΩ dashboard.js...');
        const script = document.createElement('script');
        script.src = '/assets/js/dashboard.js';
        script.onload = () => {
            console.log('dashboard.js Âä†ËΩΩÊàêÂäü');
            window.dashboardScriptLoaded = true;
            if (typeof initializeDashboard === 'function') {
                initializeDashboard();
            }
            resolve();
        };
        script.onerror = () => {
            console.error('dashboard.js Âä†ËΩΩÂ§±Ë¥•');
            reject(new Error('Failed to load dashboard.js'));
        };
        document.head.appendChild(script);
    });
}

// Âä®ÊÄÅÂä†ËΩΩ admin.js ËÑöÊú¨
function loadAdminScript() {
    return new Promise((resolve, reject) => {
        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂä†ËΩΩËøá
        if (typeof initializeAdminPage === 'function') {
            console.log('admin.js Â∑≤ÁªèÂä†ËΩΩ');
            resolve();
            return;
        }
        
        console.log('Âä®ÊÄÅÂä†ËΩΩ admin.js...');
        const script = document.createElement('script');
        script.src = '/assets/js/admin.js';
        script.onload = () => {
            console.log('admin.js Âä†ËΩΩÊàêÂäü');
            resolve();
        };
        script.onerror = () => {
            console.error('admin.js Âä†ËΩΩÂ§±Ë¥•');
            reject(new Error('Failed to load admin.js'));
        };
        document.head.appendChild(script);
    });
}

// Âä®ÊÄÅÂä†ËΩΩ sessions.js ËÑöÊú¨
function loadSessionsScript() {
    return new Promise((resolve, reject) => {
        console.log('Âä®ÊÄÅÂä†ËΩΩ sessions.js...');
        const script = document.createElement('script');
        script.src = '/assets/js/sessions.js';
        script.onload = () => {
            console.log('sessions.js Âä†ËΩΩÊàêÂäü');
            resolve();
        };
        script.onerror = () => {
            console.error('sessions.js Âä†ËΩΩÂ§±Ë¥•');
            reject(new Error('Failed to load sessions.js'));
        };
        document.head.appendChild(script);
    });
}

// ‰∫ã‰ª∂ÁõëÂê¨Âô®
document.addEventListener('DOMContentLoaded', function() {
    // ÂÖ≥Èó≠ÊåâÈíÆ
    const closeBtn = document.getElementById('closeMobileMenu');
    if (closeBtn) {
        closeBtn.addEventListener('click', closeMobileMenu);
    }
    
    // ÈÅÆÁΩ©Â±ÇÁÇπÂáªÂÖ≥Èó≠
    const overlay = document.getElementById('mobileSidebarOverlay');
    if (overlay) {
        overlay.addEventListener('click', closeMobileMenu);
    }
    
    // ÂØºËà™ÈìæÊé•ÁÇπÂáª‰∫ã‰ª∂
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        link.addEventListener('click', handleNavClick);
    });
    
    // ÁßªÂä®Á´ØËèúÂçïÊåâÈíÆ‰∫ã‰ª∂ÔºàÂú®main-content.hbs‰∏≠Â§ÑÁêÜÔºâ
    const mobileMenuButton = document.getElementById('mobileMenuButton');
    if (mobileMenuButton) {
        mobileMenuButton.addEventListener('click', openMobileMenu);
    }
    
    // Áî®Êà∑‰∏ãÊãâËèúÂçï‰∫ã‰ª∂
    const userDropdownButton = document.getElementById('userDropdownButton');
    const userDropdownMenu = document.getElementById('userDropdownMenu');
    
    if (userDropdownButton && userDropdownMenu) {
        userDropdownButton.addEventListener('click', toggleUserDropdown);
        
        // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
        document.addEventListener('click', function(e) {
            if (!userDropdownButton.contains(e.target) && !userDropdownMenu.contains(e.target)) {
                closeUserDropdown();
            }
        });
    }
    
    // ‰∏™‰∫∫ËÆæÁΩÆÂºπÁ™ó‰∫ã‰ª∂
    // Ê≥®ÊÑèÔºöËøô‰∫õ‰∫ã‰ª∂Â∑≤ÁªèÂú® main.hbs ÁöÑ initProfileModal ÂáΩÊï∞‰∏≠Â§ÑÁêÜ
    // ËøôÈáå‰∏çÂÜçÈáçÂ§çÁªëÂÆöÔºåÈÅøÂÖçÂÜ≤Á™Å
    
    // ÈáçÊñ∞Ê∑ªÂä†Âü∫Êú¨ÁöÑÂºπÁ™óÊòæÁ§∫/ÈöêËóèÂäüËÉΩ
    const openProfileModalBtn = document.getElementById('openProfileModalBtn');
    const closeProfileModalBtn = document.getElementById('closeProfileModalBtn');
    const cancelProfileBtn = document.getElementById('cancelProfileBtn');
    
    console.log('‰∏™‰∫∫ËÆæÁΩÆÂºπÁ™ó‰∫ã‰ª∂ÁªëÂÆöÊ£ÄÊü•:');
    console.log('openProfileModalBtn:', openProfileModalBtn);
    console.log('closeProfileModalBtn:', closeProfileModalBtn);
    console.log('cancelProfileBtn:', cancelProfileBtn);
    
    if (openProfileModalBtn) {
        openProfileModalBtn.addEventListener('click', showProfileModal);
        console.log('‰∏™‰∫∫ËÆæÁΩÆÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
    }
    
    if (closeProfileModalBtn) {
        closeProfileModalBtn.addEventListener('click', hideProfileModal);
        console.log('ÂÖ≥Èó≠ÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
    }
    
    if (cancelProfileBtn) {
        cancelProfileBtn.addEventListener('click', hideProfileModal);
        console.log('ÂèñÊ∂àÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
    }
    
    // Ê≥®ÈîÄÂºπÁ™ó‰∫ã‰ª∂ÁªëÂÆö
    const closeDeactivateModalBtn = document.getElementById('closeDeactivateModalBtn');
    const cancelDeactivateBtn = document.getElementById('cancelDeactivateBtn');
    const sendVerificationCodeBtn = document.getElementById('sendVerificationCodeBtn');
    const confirmDeactivateBtn = document.getElementById('confirmDeactivateBtn');
    
    if (closeDeactivateModalBtn) {
        closeDeactivateModalBtn.addEventListener('click', hideDeactivateModal);
        console.log('ÂÖ≥Èó≠Ê≥®ÈîÄÂºπÁ™óÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
    }
    
    if (cancelDeactivateBtn) {
        cancelDeactivateBtn.addEventListener('click', hideDeactivateModal);
        console.log('ÂèñÊ∂àÊ≥®ÈîÄÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
    }
    
    if (sendVerificationCodeBtn) {
        sendVerificationCodeBtn.addEventListener('click', sendVerificationCode);
        console.log('ÂèëÈÄÅÈ™åËØÅÁ†ÅÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
    }
    
    if (confirmDeactivateBtn) {
        confirmDeactivateBtn.addEventListener('click', confirmDeactivate);
        console.log('Á°ÆËÆ§Ê≥®ÈîÄÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
    }
    
    // ÁÇπÂáªÂºπÁ™óÂ§ñÈÉ®ÂÖ≥Èó≠
    const deactivateModal = document.getElementById('deactivateModal');
    if (deactivateModal) {
        deactivateModal.addEventListener('click', (e) => {
            if (e.target === deactivateModal) {
                hideDeactivateModal();
            }
        });
    }
    
    // Ë°®ÂçïÊèê‰∫§ÂäüËÉΩ
    const profileForm = document.getElementById('profileForm');
    if (profileForm) {
        profileForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('Ë°®ÂçïÊèê‰∫§‰∫ã‰ª∂Ëß¶Âèë');
            
            const submitBtn = document.getElementById('saveProfileBtn');
            const messageDiv = document.getElementById('profileMessage');
            const originalText = submitBtn.innerHTML;
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            submitBtn.innerHTML = `
                <svg class="animate-spin w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                ‰øùÂ≠ò‰∏≠...
            `;
            submitBtn.disabled = true;

            try {
                const formData = new FormData(profileForm);
                const data = Object.fromEntries(formData);
                
                // Ëé∑ÂèñËÆ§ËØÅtoken
                const token = document.cookie
                    .split('; ')
                    .find(row => row.startsWith('token='))
                    ?.split('=')[1];
                
                if (!token) {
                    messageDiv.innerHTML = `
                        <div class="p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 dark:bg-red-900/20 dark:border-red-800 dark:text-red-400">
                            <p class="text-sm">ÁôªÂΩïÂ∑≤ËøáÊúüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï</p>
                        </div>
                    `;
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                    return;
                }
                
                const response = await fetch('/api/users/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    messageDiv.innerHTML = `
                        <div class="p-3 bg-green-50 border border-green-200 rounded-lg text-green-700 dark:bg-green-900/20 dark:border-green-800 dark:text-green-400">
                            <p class="text-sm">${result.message || 'ËÆæÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ'}</p>
                        </div>
                    `;
                    
                    // Êõ¥Êñ∞È°µÈù¢‰∏äÁöÑÁî®Êà∑ÂêçÊòæÁ§∫
                    const usernameElements = document.querySelectorAll('[data-username]');
                    usernameElements.forEach(el => {
                        el.textContent = data.username;
                    });
                    
                    // 3ÁßíÂêéÂÖ≥Èó≠ÂºπÁ™ó
                    setTimeout(hideProfileModal, 3000);
                } else if (response.status === 401 || response.status === 403) {
                    // ËÆ§ËØÅÂ§±Ë¥•ÔºåÊ∏ÖÈô§cookieÂπ∂ÈáçÂÆöÂêë
                    messageDiv.innerHTML = `
                        <div class="p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 dark:bg-red-900/20 dark:border-red-800 dark:text-red-400">
                            <p class="text-sm">ÁôªÂΩïÂ∑≤ËøáÊúüÔºåÊ≠£Âú®Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢...</p>
                        </div>
                    `;
                    document.cookie = 'token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                } else {
                    messageDiv.innerHTML = `
                        <div class="p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 dark:bg-red-900/20 dark:border-red-800 dark:text-red-400">
                            <p class="text-sm">${result.error || '‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‰øùÂ≠òËÆæÁΩÆÂ§±Ë¥•:', error);
                messageDiv.innerHTML = `
                    <div class="p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 dark:bg-red-900/20 dark:border-red-800 dark:text-red-400">
                        <p class="text-sm">ÁΩëÁªúÈîôËØØÔºåËØ∑ÈáçËØï</p>
                    </div>
                `;
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });
        console.log('Ë°®ÂçïÊèê‰∫§‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
    }
    
    // ‰∏ªÈ¢òÂàáÊç¢‰∫ã‰ª∂
    const desktopDarkModeToggle = document.getElementById('desktopDarkModeToggle');
    const mobileDarkModeToggle = document.getElementById('mobileDarkModeToggle');
    
    if (desktopDarkModeToggle) {
        desktopDarkModeToggle.addEventListener('click', window.toggleDarkMode);
    }
    
    if (mobileDarkModeToggle) {
        mobileDarkModeToggle.addEventListener('click', window.toggleDarkMode);
    }
    
    // ÂàùÂßãÂåñ‰∏ªÈ¢òÂõæÊ†á
    const isDark = document.documentElement.classList.contains('dark');
    if (window.updateDarkModeIcons) {
        window.updateDarkModeIcons(isDark);
    }

    // ÊµèËßàÂô®ÂâçËøõÂêéÈÄÄÂ§ÑÁêÜ
    window.addEventListener('popstate', function(event) {
        if (event.state && event.state.contentType) {
            showContent(event.state.contentType);
        } else {
            showContent('dashboard');
        }
    });
});
</script> 